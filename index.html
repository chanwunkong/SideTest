<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èªè¨€å­¸ç¿’æ§åˆ¶ä¸­å¿ƒ</title>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore-compat.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, sans-serif;
        }

        body {
            background-color: #0b1220;
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .card {
            background: #111827;
            width: 100%;
            max-width: 500px;
            padding: 20px;
            border-radius: 20px;
            border: 1px solid #1f2937;
            margin-bottom: 25px;
        }

        h1 {
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #22d3ee;
        }

        label {
            font-size: 13px;
            color: #cbd5e1;
            margin-top: 15px;
            display: block;
        }

        select,
        button {
            width: 100%;
            padding: 12px;
            margin-top: 8px;
            border-radius: 12px;
            border: 1px solid #1f2937;
            background: #0b1220;
            color: white;
            font-size: 16px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 100%;
            max-width: 500px;
        }

        .nav-box {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-decoration: none;
            font-weight: bold;
            border-radius: 15px;
            aspect-ratio: 1/1;
            transition: 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .nav-box:active {
            transform: scale(0.95);
        }

        .box-1 {
            background: linear-gradient(135deg, #FF9500, #FF3B30);
        }

        .box-2 {
            background: linear-gradient(135deg, #34C759, #007AFF);
        }

        .hidden {
            display: none !important;
        }

        #userInfo {
            font-size: 12px;
            color: #22d3ee;
            margin-top: 10px;
            display: block;
            text-align: center;
        }
    </style>
</head>

<body>
    <h1>å­¸ç¿’è¨­å®šä¸­å¿ƒ</h1>

    <div class="card">
        <div id="loginSection">
            <button id="loginBtn" style="background: #0ea5e9; color: #000;">ä½¿ç”¨ Google ç™»å…¥</button>
        </div>
        <div id="logoutSection" class="hidden">
            <span id="userInfo"></span>
            <button id="logoutBtn"
                style="background: #ef4444; color: white; padding: 8px; font-size: 12px;">ç™»å‡ºå¸³è™Ÿ</button>
        </div>

        <label>ç›®æ¨™å­¸ç¿’èªè¨€</label>
        <select id="globalLang">
            <option value="en-US">English ğŸ‡ºğŸ‡¸</option>
            <option value="it-IT">Italiano ğŸ‡®ğŸ‡¹</option>
            <option value="zh-TW">ä¸­æ–‡ (ç¹é«”) ğŸ‡¹ğŸ‡¼</option>
            <option value="ja-JP">æ—¥æœ¬èª ğŸ‡¯ğŸ‡µ</option>
        </select>

        <label>å­¸ç¿’èª²ç¨‹é€²åº¦</label>
        <select id="globalCourse">
            <option value="all">å…¨éƒ¨å–®å­—</option>
            <option value="1-30">èª²ç¨‹ 1 (1-30)</option>
            <option value="31-60">èª²ç¨‹ 2 (31-60)</option>
        </select>
    </div>

    <div class="grid">
        <a href="test1.html" class="nav-box box-1">
            <span style="font-size: 2rem;">âœï¸</span>
            <span>æ‰‹å¯«ç·´ç¿’</span>
        </a>
        <a href="test2.html" class="nav-box box-2">
            <span style="font-size: 2rem;">ğŸ§©</span>
            <span>èªæ³•æ’åº</span>
        </a>
    </div>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyBqZLFskqgyiAEc127dh95rXsOPQVLSurM", projectId: "test-5dbba" };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // å„²å­˜è¨­å®šåˆ° localStorage
        const syncSettings = () => {
            localStorage.setItem('userLang', document.getElementById('globalLang').value);
            localStorage.setItem('userCourse', document.getElementById('globalCourse').value);
        };

        document.getElementById('globalLang').onchange = syncSettings;
        document.getElementById('globalCourse').onchange = syncSettings;

        // ç™»å…¥ç›£è½ï¼šç²å– Key ä¸¦å­˜å…¥ localStorage
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('logoutSection').classList.remove('hidden');
                document.getElementById('userInfo').textContent = `å·²ç™»å…¥ï¼š${user.email}`;
                db.collection('users').doc(user.uid).get().then(doc => {
                    if (doc.exists) localStorage.setItem('gptApiKey', doc.data().gptApiKey);
                });
            } else {
                document.getElementById('loginSection').classList.remove('hidden');
                document.getElementById('logoutSection').classList.add('hidden');
                localStorage.removeItem('gptApiKey');
            }
        });

        document.getElementById('loginBtn').onclick = () => auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
        document.getElementById('logoutBtn').onclick = () => auth.signOut();

        // åˆå§‹è¼‰å…¥è¨­å®š
        window.onload = () => {
            if (localStorage.getItem('userLang')) document.getElementById('globalLang').value = localStorage.getItem('userLang');
            if (localStorage.getItem('userCourse')) document.getElementById('globalCourse').value = localStorage.getItem('userCourse');
            syncSettings();
        };
    </script>
</body>

</html>